<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Plain Memo</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #121212; /* より深い黒 */
            --gutter-bg: #1a1a1a;
            --text-color: #e0e0e0;
            --line-number-color: #555;
            --accent-color: #ffffff; /* アクセントは白でシンプルに */
            --font-family: 'JetBrains Mono', monospace;
        }

        body, html {
            margin: 0; padding: 0; height: 100%;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-family);
            overflow: hidden;
            position: fixed;
            width: 100%;
        }

        .container { 
            display: flex; 
            height: calc(100svh - 35px); 
            width: 100%; 
        }

        #line-numbers {
            width: 50px; padding: 20px 0; text-align: right;
            background-color: var(--gutter-bg); color: var(--line-number-color);
            font-size: 13px; line-height: 1.6; user-select: none; overflow: hidden;
            border-right: 1px solid #222;
        }

        #editor {
            flex: 1; padding: 20px; border: none; outline: none;
            background: transparent; color: inherit; font-family: inherit;
            font-size: 16px; line-height: 1.6; resize: none;
            white-space: pre; overflow: auto;
            -webkit-appearance: none;
        }

        .status-bar {
            height: 35px; background: #1a1a1a;
            display: flex; justify-content: space-between;
            align-items: center; padding: 0 15px; font-size: 11px; color: #777;
            border-top: 1px solid #222;
        }

        .logo { font-weight: 500; color: #999; letter-spacing: 1px; }

        .controls { display: flex; align-items: center; }

        .controls button {
            background: transparent; border: 1px solid #444; color: #aaa;
            padding: 3px 12px; cursor: pointer; font-size: 10px;
            border-radius: 2px; margin-left: 15px; transition: 0.2s;
            text-transform: uppercase;
        }

        @media (hover: hover) {
            .controls button:hover { border-color: #fff; color: #fff; }
        }

        @media (max-width: 600px) {
            #line-numbers { width: 40px; }
            #stats { display: none; }
        }
    </style>
</head>
<body>

    <div class="container">
        <div id="line-numbers">1</div>
        <textarea id="editor" spellcheck="false" autocomplete="off" placeholder="Type something..."></textarea>
    </div>

    <div class="status-bar">
        <div class="logo">PLAIN MEMO</div>
        <div class="controls">
            <span id="stats">LN: 1 | CH: 0</span>
            <button onclick="downloadText()">Export</button>
        </div>
    </div>

    <script>
        const editor = document.getElementById('editor');
        const lineNumbers = document.getElementById('line-numbers');
        const stats = document.getElementById('stats');

        function updateEditor() {
            const text = editor.value;
            const lines = text.split('\n');
            lineNumbers.innerText = Array.from({length: lines.length}, (_, i) => i + 1).join('\n');
            stats.innerText = `LN: ${lines.length} | CH: ${text.length}`;
            localStorage.setItem('plain-memo-data', text);
        }

        function getTimestampFilename() {
            const now = new Date();
            const pad = (n) => String(n).padStart(2, '0');
            return `memo_${now.getFullYear()}${pad(now.getMonth()+1)}${pad(now.getDate())}${pad(now.getHours())}${pad(now.getMinutes())}${pad(now.getSeconds())}.txt`;
        }

        function downloadText() {
            const text = editor.value;
            if (!text) return;
            const blob = new Blob([text], { type: 'text/plain' });
            const anchor = document.createElement('a');
            anchor.download = getTimestampFilename();
            anchor.href = window.URL.createObjectURL(blob);
            anchor.click();
            setTimeout(() => window.URL.revokeObjectURL(anchor.href), 100);
        }

        editor.addEventListener('input', updateEditor);
        editor.addEventListener('scroll', () => { lineNumbers.scrollTop = editor.scrollTop; });

        window.onload = () => {
            const savedData = localStorage.getItem('plain-memo-data');
            if (savedData) {
                editor.value = savedData;
                updateEditor();
            }
            // PCの場合は自動でフォーカス
            if (!('ontouchstart' in window)) editor.focus();
        };

        window.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                downloadText();
            }
        });
    </script>
</body>
</html>